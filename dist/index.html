<!DOCTYPE html><html lang="en"><head><title>BACK</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"><style type="text/css">body,html{width:100%;height:100%;margin:0;padding:0;overflow:hidden;background-color:#fff;color:#000}#game{display:block;height:100%;margin:0 auto;cursor:crosshair;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-o-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:pixelated}</style></head><body><canvas id="game" height="256"></canvas><script type="text/javascript">!function(t){var e={};function i(s){if(e[s])return e[s].exports;var h=e[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(s,h,function(e){return t[e]}.bind(null,h));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){},function(t,e,i){"use strict";i.r(e);var s,h;i(0);function r(t,e,i,s=!1){t.addEventListener(e,i,s)}class o{static get(t=1,e=0,i=!0){if(t<=e)return t;o.seed=(9301*o.seed+49297)%233280;let s=e+o.seed/233280*(t-e);return i?Math.round(s):s}}o.seed=Math.random(),function(t){t[t.FIRE=0]="FIRE",t[t.ALT=32]="ALT",t[t.LEFT=65]="LEFT",t[t.RIGHT=68]="RIGHT",t[t.UP=87]="UP",t[t.DOWN=83]="DOWN"}(s||(s={}));class n{constructor(t=0,e=0){this.x=t,this.y=e}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get angle(){return Math.atan2(this.y,this.x)}set(t,e=t){return t instanceof n?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this}add(t,e=t){return t instanceof n?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=e),this}sub(t,e=t){return t instanceof n?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=e),this}scale(t){return this.x*=t,this.y*=t,this}tile(t){return new n(Math.floor(this.x/t),Math.floor(this.y/t))}invert(){return this.x=-this.x,this.y=-this.y,this}normalize(){const t=this.length;return t>0&&this.scale(1/t),this}clone(){return new n(this.x,this.y)}}class d{constructor(t,e,i=e){this.pos=t,this.width=e,this.height=i}get center(){return new n(this.width/2+this.pos.x,this.height/2+this.pos.y)}collide(t){return this.pos.x<t.pos.x+t.width&&this.pos.x+this.width>t.pos.x&&this.pos.y<t.pos.y+t.height&&this.height+this.pos.y>t.pos.y}contains(t){return this.pos.x<=t.pos.x&&this.pos.x+this.width>=t.pos.x+t.width&&this.pos.y<=t.pos.y&&this.pos.y+this.height>=t.pos.y+t.height}intersect(t){let e=Math.round(this.pos.x),i=Math.round(this.pos.y),s=e+this.width,h=i+this.height,r=Math.round(t.pos.x),o=Math.round(t.pos.y),a=r+t.width,l=o+t.height,c=e<r?r:e,u=i<o?o:i,p=s<a?s:a,f=h<l?h:l;return new d(new n(c,u),p-c,f-u)}}class a{constructor(){this.children=[]}addChild(t){this.children.push(t),t.parent=this}removeChild(t){const e=this.children.indexOf(t);e>=0&&(this.children.splice(e,1),t.parent=null)}render(t){this.children.forEach(e=>e.render(t))}update(t){this.children.forEach(e=>e.update(t))}}class l extends a{constructor(t){super(),this.factory=t,this.pool=[]}create(t=null){let e=this.pool.pop();return e||(e=this.factory()),this.addChild(e),t&&t(e),e}removeChild(t){super.removeChild(t),this.pool.push(t)}}class c extends l{constructor(){super(...arguments),this.pos=new n(0,100),this.dir=new n,this.aim=new n,this.spd=.2,this.box=new d(this.pos,16,24),this.fire=!1,this.fireTime=0,this.fireSpeed=100}render(t){super.render(t);const e=this.box,i=this.pos;t.save(),t.fillStyle="blue",t.fillRect(Math.round(i.x),Math.round(i.y),e.width,e.height),t.restore()}update(t){super.update(t),this.fireTime-=t,this.fire&&this.fireTime<=0&&(this.create(t=>{t.pos.set(this.pos.x+this.box.width/2,this.pos.y+this.box.height/2),t.dir=this.aim.clone().sub(this.pos).normalize()}),this.fireTime=this.fireSpeed)}}!function(t){t[t.WALL=0]="WALL",t[t.GROUND=1]="GROUND",t[t.HOLE=2]="HOLE"}(h||(h={}));class u extends a{constructor(t,e,i){super(),this.width=t,this.height=e,this.size=i,this.tiles=[],this.nav=[],this.target=new n;for(let i=0;i<e;i++){let e=[];e.length=t,e.fill(h.GROUND),this.tiles[i]=e,(e=[]).length=t,e.fill(u.MAX_NAV),this.nav[i]=e}}render(t){const e=this.size;t.save();for(let i=0;i<this.height;i++)for(let s=0;s<this.width;s++)this.tiles[i][s]===h.GROUND&&(t.fillStyle="#ccc",t.fillRect(s*e+1,i*e+1,e-2,e-2),t.fillStyle="#ddd",t.fillText(this.nav[i][s].toString(),s*e+2,i*e+10));t.restore(),super.render(t)}set(t,e,i){e>=0&&e<this.height&&t>=0&&t<this.width&&(this.tiles[e][t]=i)}get(t,e){return e>=0&&e<this.height&&t>=0&&t<this.width?this.tiles[e][t]:h.WALL}collideX(t,e=!1){let i=t.pos,s=this.size,r=Math.floor(i.y/s),o=Math.floor(i.x/s),n=Math.floor((i.x+t.width)/s);for(let d=r*s;d<i.y+t.height;d+=s){let r=Math.floor(d/s);if(this.get(o,r)!==h.GROUND)return e&&(i.x+=(o+1)*s-i.x),!0;if(this.get(n,r)!=h.GROUND)return e&&(i.x-=i.x+t.width-n*s),!0}return!1}collideY(t,e=!1){let i=t.pos,s=this.size,r=Math.floor(i.y/s),o=Math.floor(i.x/s),n=Math.floor((i.y+t.height)/s);for(let d=o*s;d<i.x+t.width;d+=s){let o=Math.floor(d/s);if(this.get(o,r)!==h.GROUND)return e&&(i.y+=(r+1)*s-i.y),!0;if(this.get(o,n)!=h.GROUND)return e&&(i.y-=i.y+t.height-n*s),!0}return!1}createNav(t){const e=Math.floor(t.x/this.size),i=Math.floor(t.y/this.size);this.target.x===e&&this.target.y===i||(this.target.set(e,i),this.nav.forEach(t=>t.fill(u.MAX_NAV)),this.setNav(e,i))}setDirection(t){const e=this.size,i=t.box.center,s=i.tile(e);t.dir.set(0,0);let r=u.MAX_NAV;r=this.setDir(t,s,new n(1,0),r),r=this.setDir(t,s,new n(-1,0),r),r=this.setDir(t,s,new n(0,1),r),r=this.setDir(t,s,new n(0,-1),r),t.dir.x?(this.get(s.x,s.y+1)!==h.WALL&&(r=this.setDir(t,s,new n(t.dir.x,1),r)),this.get(s.x,s.y-1)!==h.WALL&&(r=this.setDir(t,s,new n(t.dir.x,-1),r))):t.dir.y&&(this.get(s.x+1,s.y)!==h.WALL&&(r=this.setDir(t,s,new n(1,t.dir.y),r)),this.get(s.x-1,s.y)!==h.WALL&&(r=this.setDir(t,s,new n(-1,t.dir.y),r))),t.dir.add(s).scale(e).add(e/2).sub(i).normalize()}setDir(t,e,i,s){const h=this.getNav(e.x+i.x,e.y+i.y);return s>h&&(t.dir=i,s=h),s}getNav(t,e){return e>=0&&e<this.height&&t>=0&&t<this.width?this.nav[e][t]:u.MAX_NAV}setNav(t,e,i=0){i>=u.MAX_NAV||this.get(t,e)===h.WALL||i>=this.nav[e][t]||(this.nav[e][t]=i++,this.setNav(t+1,e,i),this.setNav(t,e+1,i),this.setNav(t-1,e,i),this.setNav(t,e-1,i))}}u.MAX_NAV=30;class p extends l{constructor(t,e,i=new n,s=0){super(t),this.factory=t,this.init=e,this.pos=i,this.period=s,this.time=0,this.box=new d(this.pos,16,16)}update(t){super.update(t),this.period<=0||(this.time+=t,this.time>this.period&&(this.time-=this.period,this.create(this.init)))}}class f extends p{render(t){if(super.render(t),!this.period)return;const e=this.box.center;t.save(),t.fillStyle="grey",t.beginPath(),t.arc(Math.round(e.x),Math.round(e.y),this.box.width/2,0,2*Math.PI),t.closePath(),t.fill(),t.restore()}}class x extends a{constructor(t){super(),this.hero=t,this.pos=new n,this.dir=new n,this.spd=.1,this.box=new d(this.pos,16,16)}render(t){const e=this.box,i=this.pos;t.save(),t.fillStyle="red",t.fillRect(Math.round(i.x),Math.round(i.y),e.width,e.height),t.restore()}update(t){this.box.collide(this.hero.box)&&this.parent.removeChild(this);for(const t of this.hero.children)if(this.box.collide(t.box))return this.parent.removeChild(this),void this.hero.removeChild(t)}}class y extends a{constructor(){super(...arguments),this.pos=new n,this.dir=new n,this.spd=.4,this.box=new d(this.pos,6)}render(t){const e=this.box.center;t.save(),t.fillStyle="black",t.beginPath(),t.arc(Math.round(e.x),Math.round(e.y),this.box.width/2,0,2*Math.PI),t.closePath(),t.fill(),t.restore()}}const w=(g="#game",(m||document).querySelector(g));var g,m;const b=w.getContext("2d"),v=new class extends a{constructor(){super(),this.hero=new c(()=>new y),this.map=new u(12,16,16),this.spawners=[new f(()=>new x(this.hero),t=>t.pos.set(t.parent.pos),new n(64,16),500),new f(()=>new x(this.hero),t=>t.pos.set(t.parent.pos),new n(128,32),500)],this.map.set(3,4,h.WALL),this.map.set(4,4,h.WALL),this.map.set(5,4,h.WALL),this.map.set(6,5,h.WALL),this.map.set(7,6,h.WALL),this.map.set(8,6,h.WALL),this.map.set(9,5,h.WALL),this.hero.pos.set(96,192),this.addChild(this.map),this.addChild(this.hero),this.spawners.forEach(t=>this.addChild(t))}update(t){super.update(t),this.updateHero(this.hero,t),this.map.createNav(this.hero.box.center),this.hero.children.forEach(e=>this.updateProjectile(e,t)),this.spawners.forEach(e=>{e.children.forEach(e=>this.updateEnemy(e,t))})}updateHero(t,e){t.dir.x&&(t.pos.x+=t.dir.x*t.spd*e,this.map.collideX(t.box,!0)),t.dir.y&&(t.pos.y+=t.dir.y*t.spd*e,this.map.collideY(t.box,!0))}updateEnemy(t,e){this.map.setDirection(t);const i=t.spd*e;t.pos.add(t.dir.x*i,t.dir.y*i)}updateProjectile(t,e){const i=t.spd*e;t.pos.add(t.dir.x*i,t.dir.y*i),(this.map.collideX(t.box)||this.map.collideY(t.box))&&t.parent.removeChild(t)}pointer(t,e){this.hero.aim.set(t,e)}input(t,e){let i=0,h=0;t[s.LEFT]&&(i-=1),t[s.RIGHT]&&(i+=1),t[s.UP]&&(h-=1),t[s.DOWN]&&(h+=1),this.hero.dir.set(i,h).normalize(),this.hero.fire=!0===t[s.FIRE]}},M=[];let L;function A(){const t=(new Date).getTime(),e=t-L;requestAnimationFrame(A),v.update(e<34?e:34),L=t,b.clearRect(0,0,w.width,w.height),v.render(b)}function N(){const t=document.body;w.width=w.height/t.clientHeight*t.clientWidth}r(window,"load",async()=>{N(),r(document,"keydown",t=>{M[t.keyCode]=!0,v.input(M,!0)}),r(document,"keyup",t=>{M[t.keyCode]=!1,v.input(M,!1)}),r(document,"mousedown",t=>{M[t.button]=!0,v.input(M,!0)}),r(document,"mouseup",t=>{M[t.button]=!1,v.input(M,!1)}),r(document,"mousemove",t=>{const e=document.body,i=w.height/e.clientHeight;v.pointer(t.clientX*i,t.clientY*i)}),r(window,"resize",N),L=(new Date).getTime(),A()})}]);</script></body></html>