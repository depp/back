<!DOCTYPE html><html lang="en"><head><title>BACK</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"><style type="text/css">body,html{width:100%;height:100%;margin:0;padding:0;overflow:hidden;background:#000;color:#fff;cursor:crosshair}#game{display:none;margin:0 auto;height:100%;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-o-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:pixelated;background:#c96}</style></head><body><canvas id="game"></canvas><script src="map.js"></script><script type="text/javascript">!function(t){var e={};function s(i){if(e[i])return e[i].exports;var h=e[i]={i:i,l:!1,exports:{}};return t[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)s.d(i,h,function(e){return t[e]}.bind(null,h));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=3)}([function(t,e,s){},function(t,e){t.exports="data:image/png;base64,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"},function(t){t.exports=JSON.parse('{"cave":[0,0],"hero":[0,24],"font":[0,48],"item":[64,24],"splash":[112,24],"runner":[160,24],"camp":[192,24],"hole":[208,24],"plasma":[64,40],"shot":[217,40],"grenade":[224,24]}')},function(t,e,s){"use strict";s.r(e);s(0);window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext;const i=new AudioContext,h={},o={},r=[];let n;class a{constructor(t,e,s){this.type=t,this.length=s,this.curve=Float32Array.from(e)}getTime(t){return(t<this.length?t:this.length)-.01}}var d,l,c,u={async init(){"suspended"===i.state&&await i.resume();const t=Math.pow(2,1/12);for(let e=-57;e<50;e++)r.push(440*Math.pow(t,e));const e=(n=i.createBuffer(1,88200,44100)).getChannelData(0);for(let t=0;t<88200;t++)e[t]=2*Math.random()-1},async sound(t,e,s,i){const h=new OfflineAudioContext(1,44100*i,44100),r=h.createGain(),a=Float32Array.from(s);if(r.connect(h.destination),e.curve&&r.gain.setValueCurveAtTime(e.curve,0,e.getTime(i)),h.addEventListener("complete",e=>o[t]=e.renderedBuffer),"custom"==e.type){const t=h.createBiquadFilter();t.connect(r),t.detune.setValueCurveAtTime(a,0,i);const e=h.createBufferSource();e.buffer=n,e.loop=!0,e.connect(t),e.start()}else{const t=h.createOscillator();t.type=e.type,t.frequency.setValueCurveAtTime(a,0,i),t.connect(r),t.start(),t.stop(i)}await h.startRendering()},async music(t,e){const s=e.reduce((t,e)=>e.length>t?e.length:t,0),i=new OfflineAudioContext(1,44100*s,44100);i.addEventListener("complete",e=>o[t]=e.renderedBuffer),e.forEach((t,e)=>t.play(i)),await i.startRendering()},mixer:t=>(t in h||(h[t]=i.createGain(),h[t].connect(i.destination)),h[t]),play(t,e=!1,s="master"){if(t in o){let h=i.createBufferSource();return h.loop=e,h.buffer=o[t],h.connect(this.mixer(s)),h.start(),h}return null}};function p(t,e,s,i=!1){t.addEventListener(e,s,i)}class m{static get(t=1,e=0,s=!0){if(t<=e)return t;m.seed=(9301*m.seed+49297)%233280;let i=e+m.seed/233280*(t-e);return s?Math.round(i):i}}m.seed=Math.random(),function(t){t[t.FIRE=0]="FIRE",t[t.ALT=2]="ALT",t[t.LEFT=65]="LEFT",t[t.RIGHT=68]="RIGHT",t[t.UP=87]="UP",t[t.DOWN=83]="DOWN"}(d||(d={}));class g{constructor(t=0,e=0){this.x=t,this.y=e}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get angle(){return Math.atan2(this.y,this.x)}set(t,e=t){return t instanceof g?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this}add(t,e=t){return t instanceof g?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=e),this}sub(t,e=t){return t instanceof g?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=e),this}scale(t){return this.x*=t,this.y*=t,this}tile(t){return new g(Math.floor(this.x/t),Math.floor(this.y/t))}invert(){return this.x=-this.x,this.y=-this.y,this}normalize(){const t=this.length;return t>0&&this.scale(1/t),this}clone(){return new g(this.x,this.y)}}class w{constructor(t,e,s=e){this.pos=t,this.width=e,this.height=s,this._center=new g}get center(){return this._center.set(this.width/2+this.pos.x,this.height/2+this.pos.y),this._center}get bottom(){return this.pos.y+this.height}collide({pos:t,width:e,height:s}){return this.pos.x<t.x+e&&this.pos.x+this.width>t.x&&this.pos.y<t.y+s&&this.height+this.pos.y>t.y}contains({pos:t,width:e,height:s}){return this.pos.x<=t.x&&this.pos.x+this.width>=t.x+e&&this.pos.y<=t.y&&this.pos.y+this.height>=t.y+s}intersect({pos:t,width:e,height:s}){let i=Math.round(this.pos.x),h=Math.round(this.pos.y),o=i+this.width,r=h+this.height,n=Math.round(t.x),a=Math.round(t.y),d=n+e,l=a+s,c=i<n?n:i,u=h<a?a:h,p=o<d?o:d,m=r<l?r:l;return new w(new g(c,u),p-c,m-u)}}class f{constructor(t,e=null,s=null,i=!0){this.type=t,this.target=e,this.payload=s,this.bubble=i,this.stoped=!1}stop(){this.stoped=!0}}class x{constructor(){this.children=[],this.listeners={all:[]}}addChild(t){return this.children.push(t),t.parent=this,this}removeChild(t){const e=this.children.indexOf(t);e>=0&&(this.children.splice(e,1),t.parent=null)}each(t){for(let e=this.children.length-1;e>=0;e--)t(this.children[e],e)}on(t,e){const s=t.match(/[a-zA-Z]+/g);s&&s.forEach(t=>{t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push(e)})}emit(t){for(const e of this.listeners.all){if(t.stoped)return;e(t)}if(t.type in this.listeners)for(const e of this.listeners[t.type]){if(t.stoped)return;e(t)}t.bubble&&this.parent&&this.parent.emit(t)}render(t){this.children.forEach(e=>e.render(t))}update(t){this.children.forEach(e=>e.update(t))}}class b extends x{constructor(t){super(),this.factory=t,this.pool=[]}create(t=null){let e=this.pool.pop();return e||(e=this.factory()),this.addChild(e),t&&t(e),e}removeChild(t){super.removeChild(t),this.pool.push(t)}}class y extends b{constructor(t,e,s,i=0,h=0){super(t),this.factory=t,this.init=e,this.box=s,this.frq=i,this.limit=h,this.pos=this.box.pos,this.time=0}create(t=null){return!this.limit||this.children.length<this.limit?super.create(t):null}update(t){super.update(t),this.frq<=0||(this.time+=t,this.time>this.frq&&(this.time-=this.frq,this.create(this.init)))}}class A{constructor(){}static load(t,e){return new Promise(s=>{const i=new Image;p(i,"load",()=>{A.image.push(i),A.config=e,s(i)}),i.src=t})}static tint(t,e,s,i){return new Promise(h=>{const o=t.canvas;let r=A.image[0];o.width=r.width,o.height=r.height,t.drawImage(A.image[0],0,0);const n=t.getImageData(0,0,o.width,o.height),a=n.data;for(let t=0;t<n.data.length;t+=4)a[t+3]&&(a[t]=Math.round(a[t]*e),a[t+1]=Math.round(a[t+1]*s),a[t+2]=Math.round(a[t+2]*i));t.putImageData(n,0,0),p(r=new Image,"load",()=>{A.image.push(r),h(r)}),r.src=o.toDataURL()})}static draw(t,e,{pos:s,width:i,height:h},o=0,r=!1,n=!1){const a=e.match(/^([a-z]+)([0-9]*)$/);if(!(a&&a[1]in A.config))return;const d=a[2]?parseInt(a[2]):0,l=A.config[a[1]];t.save(),t.translate(Math.round(s.x),Math.round(s.y)),t.scale(r?-1:1,n?-1:1),t.drawImage(A.image[d],l[0]+o*i,l[1],i,h,r?-i:0,n?-h:0,i,h),t.restore()}}A.image=[];class v extends b{constructor(t,{frq:e,amm:s,mag:i}){super(t),this.factory=t,this.time=0,this.frq=e,this.ammo=s,this.magazine=i}load(t){this.ammo+=t,this.magazine&&this.ammo>this.magazine&&(this.ammo=this.magazine)}create(t=null){return this.ammo<=0||this.frq&&this.time?null:(this.ammo--,this.time=this.frq,super.create(t))}update(t){this.time=t<this.time?this.time-t:0,super.update(t)}}class C extends x{constructor({spd:t,dmg:e,size:s,color:i}={}){super(),this.time=0,this.spd=t,this.dmg=e,this.size=s,this.color=i,this.pos=new g,this.dir=new g,this.box=new w(this.pos,this.size)}render(t){let e=Math.floor(this.time%200/50);A.draw(t,"plasma"+this.color,this.box,0,e%2>0,e>1)}update(t){this.time+=t,this.pos.add(this.dir.clone().scale(this.spd*t))}}class M extends C{constructor({spd:t,dmg:e,size:s,color:i,radius:h}={}){super({spd:t,dmg:e,size:s,color:i}),this.radius=h,this.aim=new g}render(t){A.draw(t,"grenade"+this.color,this.box)}update(t){this.box.center.sub(this.aim).length<=this.spd*t?(this.pos.set(this.aim),this.emit(new f("explode",this)),this.parent.removeChild(this)):super.update(t)}}class E extends x{constructor({x:t,y:e,hp:s,spd:i,score:h,lives:o,gun:r,gnd:n}={}){super(),this.dir=new g,this.aim=new g,this.fire=!1,this.time=0,this.hp=s,this.max=s,this.spd=i,this.lives=o,this.score=h,this.pos=new g(t,e),this.box=new w(this.pos,16,24),this.gun=new v(()=>new C(r.bul),r),this.grenades=new v(()=>new M(n.bul),n),this.addChild(this.grenades),this.addChild(this.gun)}get alive(){return this.lives>0}render(t){if(super.render(t),!this.alive)return;const e=this.aim.clone().sub(this.box.center);let s=e.y>=0?0:3,i=this.time%200,h=i<100;Math.abs(e.x)>Math.abs(e.y)&&(s=i<100?1:2,h=e.x>0),A.draw(t,"hero2",this.box,s,h)}update(t){super.update(t),this.dir.length&&(this.time+=t),this.alive&&this.fire&&this.gun.create(t=>{const e=t.box,s=this.box.center;t.dir.set(this.aim.clone().sub(s).normalize()),t.pos.set(s.sub(e.width/2,e.height/2)),this.emit(new f("fire",this,t))})}launch(){this.grenades.create(t=>{const e=t.box,s=this.box.center;t.dir.set(this.aim.clone().sub(s).normalize()),t.pos.set(s.sub(e.width/2,e.height/2)),t.aim.set(this.aim),this.emit(new f("launch"))})}hit(t){if(this.hp-=t,!(this.hp>0)){if(--this.lives>0)return this.hp=this.max,void this.emit(new f("death",this));this.hp=0,this.emit(new f("lose",this))}}}!function(t){t[t.WALL=0]="WALL",t[t.GROUND=1]="GROUND",t[t.HOLE=2]="HOLE",t[t.CAMP=3]="CAMP",t[t.SHOT=4]="SHOT",t[t.WORM=5]="WORM",t[t.HEAL=6]="HEAL",t[t.AMMO=7]="AMMO",t[t.NUKE=8]="NUKE",t[t.HERO=9]="HERO"}(l||(l={}));class O extends x{constructor(t){super(),this.map=t,this.width=14,this.height=1,this.size=16;let e=0;this.tiles=new Array(this.width+1).fill(0);for(let s=0;s<t.length;s+=2){const i=parseInt(t.charAt(s),36),h=parseInt(t.charAt(s+1),36);for(let t=0;t<h;t++)e&&e%12==0&&(this.tiles.push(0,0),this.height++),this.tiles.push(i),e++}this.tiles.push(0),this.loadFrames()}get length(){return this.width*this.height}get bottom(){return this.height*this.size}loadFrames(){this.frame=[];for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++){let s=0;this.getTile(e,t)===l.WALL&&(s+=1,this.getTile(e,t-1)===l.WALL&&(s+=1),this.getTile(e-1,t)===l.WALL&&(s+=2),this.getTile(e+1,t)===l.WALL&&(s+=4),this.getTile(e,t+1)===l.WALL&&(s+=8)),this.frame.push(s)}}render(t){const e=new g,s=new w(e,this.size,1.5*this.size);let i=0;for(let h=0;h<this.height;h++){const o=h===this.height-1;for(let r=0;r<this.width;r++){const n=this.frame[i++];(n||o)&&(e.set(r,h).scale(this.size),A.draw(t,"cave1",s,n))}e.x+=this.size}super.render(t)}setTile(t,e,s){e>=0&&e<this.height&&t>=0&&t<this.width&&(this.tiles[e*this.width+t]=s)}getTile(t,e){return e>=0&&e<this.height&&t>=0&&t<this.width?this.tiles[e*this.width+t]:l.WALL}getPosByTile(t,e=-1){const s=e>0?e:0,i=e>=0?e+1:this.height,h=[];let o=s*this.width;for(let e=s;e<i;e++)for(let s=0;s<this.width;s++)this.tiles[o++]===t&&h.push(new g(s*this.size,e*this.size));return h}collideX({pos:t,width:e,height:s},i=!1){let h=this.size,o=Math.floor(t.y/h),r=Math.floor(t.x/h),n=Math.floor((t.x+e)/h);for(let a=o*h;a<t.y+s;a+=h){let s=Math.floor(a/h);if(!this.getTile(r,s))return i&&(t.x+=(r+1)*h-t.x),!0;if(!this.getTile(n,s))return i&&(t.x-=t.x+e-n*h),!0}return!1}collideY({pos:t,width:e,height:s},i=!1){let h=this.size,o=Math.floor(t.y/h),r=Math.floor(t.x/h),n=Math.floor((t.y+s)/h);for(let a=r*h;a<t.x+e;a+=h){let e=Math.floor(a/h);if(!this.getTile(e,o))return i&&(t.y+=(o+1)*h-t.y),!0;if(!this.getTile(e,n))return i&&(t.y-=t.y+s-n*h),!0}return!1}createNav(t){const e=t.tile(this.size);this.nav=new Array(this.tiles.length).fill(O.MAX_NAV),this.setNav(e.x,e.y)}lockNav(t){const e=t.tile(this.size);this.nav[e.y*this.width+e.x]=O.MAX_NAV}setDirection(t){const e=this.size,s=t.box.center,i=s.tile(e);t.dir.set(0,0);let h=O.MAX_NAV;h=this.setDir(t,i,new g(1,0),h),h=this.setDir(t,i,new g(-1,0),h),h=this.setDir(t,i,new g(0,1),h),h=this.setDir(t,i,new g(0,-1),h),t.dir.x?(this.getTile(i.x,i.y+1)&&(h=this.setDir(t,i,new g(t.dir.x,1),h)),this.getTile(i.x,i.y-1)&&(h=this.setDir(t,i,new g(t.dir.x,-1),h))):t.dir.y&&(this.getTile(i.x+1,i.y)&&(h=this.setDir(t,i,new g(1,t.dir.y),h)),this.getTile(i.x-1,i.y)&&(h=this.setDir(t,i,new g(-1,t.dir.y),h))),t.dir.add(i).scale(e).add(e/2).sub(s).normalize()}setDir(t,e,s,i){const h=this.getNav(e.x+s.x,e.y+s.y);return i>h&&(t.dir=s,i=h),i}getNav(t,e){return e>=0&&e<this.height&&t>=0&&t<this.width?this.nav[e*this.width+t]:O.MAX_NAV}setNav(t,e,s=0){s>=O.MAX_NAV||!this.getTile(t,e)||s>=this.getNav(t,e)||(this.nav[e*this.width+t]=s++,this.setNav(t+1,e,s),this.setNav(t,e+1,s),this.setNav(t-1,e,s),this.setNav(t,e-1,s))}}O.MAX_NAV=30;class T extends x{constructor(t,{hp:e,dmg:s,score:i}={}){super(),this.hero=t,this.pos=new g,this.box=new w(this.pos,16),this.hp=e,this.max=e,this.dmg=s,this.score=i}update(t){if(super.update(t),this.box.collide(this.hero.box))return this.emit(new f("hit",this.hero,this.dmg)),this.emit(new f("kill",this)),void this.parent.removeChild(this);for(const t of this.hero.gun.children)if(this.box.collide(t.box))return this.emit(new f("hit",this,t.dmg)),void t.parent.removeChild(t)}hit(t){this.hp-=t,this.hp>0||(this.emit(new f("kill",this)),this.parent.removeChild(this),this.hp=this.max)}}class R extends T{render(t){A.draw(t,"camp2",this.box)}}class D extends T{constructor(t,{hp:e,dmg:s,score:i,far:h,gun:o}={}){super(t,{hp:e,dmg:s,score:i}),this.hero=t,this.far=h,this.gun=new v(()=>new C(o.bul),o),this.addChild(this.gun)}render(t){A.draw(t,"shot1",this.box),super.render(t)}update(t){super.update(t);const e=this.hero;if(!e.alive)return;this.gun.each(t=>{t.box.collide(e.box)&&(this.emit(new f("hit",e,t.dmg)),t.parent.removeChild(t))});const s=this.box.center,i=e.box.center.sub(s);i.length>this.far||this.gun.create(t=>{const e=t.box;t.dir.set(i.normalize()),t.pos.set(s.sub(e.width/2,e.height/2)),this.emit(new f("eject",t))})}}class q extends T{constructor(t,{hp:e,dmg:s,score:i,far:h,gun:o,spd:r}={}){super(t,{hp:e,dmg:s,score:i,far:h,gun:o}),this.hero=t,this.dir=new g,this.time=0,this.spd=r}render(t){let e=Math.floor(this.time%400/100);A.draw(t,"runner5",this.box,e>1?3-e:e,e>1)}update(t){super.update(t),this.time+=t}}class L extends y{constructor(t,e,s,{frq:i,limit:h,near:o,far:r}){super(t,e,s,i,h),this.factory=t,this.init=e,this.box=s,this.active=!1,this.near=o,this.far=r}create(t=null){return this.active?super.create(t):null}toggle(t){const e=this.box.center.sub(t).length;e>this.far?this.active=!1:!this.active&&t.y>this.box.center.y&&e<this.near&&(this.active=!0,this.emit(new f("spawn",this)))}render(t){A.draw(t,"hole1",this.box),super.render(t)}}class S extends x{constructor(t,e="",s=6,i=8){super(),this.pos=t,this._text=e,this.width=s,this.height=i,this.box=new w(t,this._text.length*s,i)}set text(t){this._text=t,this.box.width=t.length*this.width}render(t){const e=new w(this.pos.clone(),this.width,this.height);for(let s=0;s<this._text.length;s++){let i=this._text.charCodeAt(s);if(i>=48&&i<=57)i-=48;else if(i>=97&&i<=122)i-=87;else{if(!(i>=65&&i<=90)){e.pos.x+=this.width;continue}i-=55}A.draw(t,"font",e,i),e.pos.x+=this.width}}}!function(t){t[t.start=0]="start",t[t.run=1]="run",t[t.lose=2]="lose",t[t.win=3]="win"}(c||(c={}));class I extends x{constructor(t,e){super(),this.hero=t,this.cam=e,this.satus=c.start,this.text=new S(new g(16)),this.message=new S(new g(32,120)),this.messages=["Click to Start","","Game Over","Level Complete"],this.addChild(this.text).addChild(this.message),this.update(0)}update(t){const e=this.cam.box,s=this.message.box,i=this.hero,h=new String(i.score+1e6).substr(1);this.text.text=`SQUAD ${i.lives}  GRENADE ${i.grenades.ammo}  SCORE ${h}`,this.message.pos.set((e.width-s.width)/2,(e.height-s.height)/2),this.message.text=this.messages[this.satus]}}class z extends x{constructor(t,e,s,i){super(),this.hero=t,this.value=e,this.frame=s,this.color=i,this.pos=new g,this.box=new w(this.pos,16)}render(t){A.draw(t,"item"+this.color,this.box,this.frame)}update(t){this.box.collide(this.hero.box)&&(this.power(),this.emit(new f("item",this)),this.parent.removeChild(this))}}class G extends z{power(){const t=this.hero;t.hp+=this.value,t.hp>t.max&&(t.hp=t.max)}}class B extends z{power(){this.hero.grenades.load(this.value)}}var W={cam:{x:0,y:0,width:224,height:256,spd:.02},hero:{x:96,y:128,hp:100,spd:.07,score:0,lives:3,gun:{frq:80,amm:9999,mag:0,bul:{spd:.4,dmg:25,size:6,color:0}},gnd:{frq:500,amm:5,mag:10,bul:{spd:.2,dmg:50,size:10,color:2,radius:48}}},camp:{hp:20,dmg:5,score:10},shot:{hp:50,dmg:0,score:50,far:200,gun:{frq:800,amm:9999,mag:0,bul:{spd:.1,dmg:10,size:6,color:4}}},hole:{frq:300,limit:20,near:180,far:320},runr:{hp:10,dmg:10,spd:.07,score:25}};class P extends x{constructor(){super(...arguments),this.pos=new g,this.box=new w(this.pos,16),this.time=0,this.flip=!1,this.frame=0}render(t){A.draw(t,"splash3",this.box,this.frame,this.flip)}update(t){super.update(t),this.time+=t,this.frame=Math.floor(this.time/100),this.frame>2&&this.parent.removeChild(this)}}class N extends x{constructor(t,{x:e,y:s,width:i,height:h,spd:o},r){super(),this.hero=t,this.bottom=r,this.move=!0,this.pos=new g(e,s),this.box=new w(this.pos,i,h),this.spd=o}update(t){const e=this.hero;e.alive&&e.box.bottom<=this.pos.y&&(e.lives--,this.emit(new f("death",e))),this.move&&(this.pos.y+=this.spd*t,this.pos.y+this.box.height>this.bottom&&(this.pos.y=this.bottom-this.box.height,this.move=!1))}}class H extends x{constructor(t){super(),this.map=t,this.hero=new E(W.hero),this.cam=new N(this.hero,W.cam,this.map.bottom),this.hud=new I(this.hero,this.cam),this.aim=new g,this.holes=[],this.camps=new b(()=>new R(this.hero,W.camp)),this.shots=new b(()=>new D(this.hero,W.shot)),this.explos=new b(()=>new P),this.onHit=t=>{const e=t.target;e instanceof T&&e.hit(t.payload),e instanceof E&&e.hit(t.payload)},this.onKill=t=>{const e=t.target;this.hero.score+=e.score,this.createExplo(e.pos)},this.onDeath=t=>{const e=t.target,s=e.pos.clone();this.createExplo(s),this.createExplo(s.add(0,8)),this.revive(e)},this.onExplode=t=>{const e=t.target;this.camps.each(t=>this.explode(e,t)),this.shots.each(t=>this.explode(e,t));for(const t of this.holes)t.each(t=>this.explode(e,t))},this.hero.pos.set(96,112),this.map.createNav(this.hero.box.center),this.addChild(this.cam).addChild(this.map);for(const t of this.map.getPosByTile(l.HERO))this.hero.pos.set(t);for(const t of this.map.getPosByTile(l.CAMP))this.camps.create(e=>e.pos.set(t));for(const t of this.map.getPosByTile(l.SHOT))this.shots.create(e=>e.pos.set(t));for(const t of this.map.getPosByTile(l.HEAL)){let e=new G(this.hero,100,0,0);e.pos.set(t),this.addChild(e)}for(const t of this.map.getPosByTile(l.AMMO)){let e=new B(this.hero,100,1,0);e.pos.set(t),this.addChild(e)}for(const t of this.map.getPosByTile(l.HOLE)){const e=new L(()=>new q(this.hero,W.runr),e=>e.pos.set(t),new w(t,16,16),W.hole);this.holes.push(e),this.addChild(e)}this.addChild(this.camps).addChild(this.shots).addChild(this.hero).addChild(this.explos),this.bind()}bind(){this.on("all",t=>u.play(t.type)),this.on("hit",this.onHit),this.on("kill",this.onKill),this.on("death",this.onDeath),this.on("explode",this.onExplode),this.on("lose",t=>{this.hud.satus=c.lose}),this.on("win",t=>{this.hud.satus=c.win})}revive(t){const e=this.map;let s=Math.floor(this.cam.box.bottom/e.size);s>e.height&&(s=e.height-1);const i=e.getPosByTile(l.GROUND,s),h=i.length>1?m.get(i.length-1):0;t.hp=t.max,t.pos.set(i[h])}explode(t,e){const s=t.box.center,i=e.box.center.sub(s).length;t.radius>=i&&this.emit(new f("hit",e,t.dmg))}createExplo(t){this.explos.create(e=>{e.pos.set(t),e.time=0,e.flip=Math.random()<.5,e.frame=0})}render(t){t.save(),t.translate(0,-Math.round(this.cam.pos.y)),super.render(t),t.restore(),this.hud.render(t)}update(t){this.hud.update(t),this.hud.satus===c.run&&(super.update(t),this.updateProjectile(t),this.updateHero(t),this.updateMap(),this.updateSpawners(t))}updateHero(t){const e=this.hero,s=this.map,i=this.cam,h=i.box.bottom-e.box.bottom;e.dir.x&&(e.pos.x+=e.dir.x*e.spd*t,s.collideX(e.box,!0)),e.dir.y&&(e.dir.y<0||h>0)&&(e.pos.y+=e.dir.y*e.spd*t,s.collideY(e.box,!0)),e.box.bottom>=s.bottom&&e.emit(new f("win",e)),e.aim.set(this.aim).add(-i.pos.x,i.pos.y)}updateProjectile(t){this.hero.gun.each(t=>{(this.map.collideX(t.box)||this.map.collideY(t.box))&&t.parent.removeChild(t)}),this.hero.grenades.each(t=>{(this.map.collideX(t.box)||this.map.collideY(t.box))&&(t.emit(new f("explode",t)),t.parent.removeChild(t))}),this.shots.each(t=>{t.gun.each(t=>{(this.map.collideX(t.box)||this.map.collideY(t.box))&&t.parent.removeChild(t)})})}updateMap(){this.map.createNav(this.hero.box.center);for(const t of this.holes)for(const e of t.children)this.map.lockNav(e.box.center)}updateSpawners(t){for(const e of this.holes){e.toggle(this.hero.pos);for(const s of e.children){this.map.setDirection(s);const e=s.spd*t;s.pos.add(s.dir.x*e,s.dir.y*e)}}}pointer(t,e){this.aim.set(t,e)}input(t,e){let s=0,i=0;t[d.LEFT]&&(s-=1),t[d.RIGHT]&&(s+=1),t[d.UP]&&(i-=1),t[d.DOWN]&&(i+=1),this.hero.dir.set(s,i).normalize(),this.hero.fire=!0===t[d.FIRE],t[d.ALT]&&e&&this.hero.launch()}}const j=(U="#game",(J||document).querySelector(U));var U,J;const V=j.getContext("2d"),X=[],k=["021605190212211541120115911z1j013516061a031a03162113021a021a02190317041s01115811021a021b0111023216310516411402182111021a021a01130215021302611402130213811102130215021b011z17033118043117053116061507147107140715061507140715071605311621041902311921011e310417061606160518031f411q011b011b0217210516061603"];let F=new H(new O(k[0])),Q=!1,K=(new Date).getTime();function Z(){V.clearRect(0,0,j.width,j.height),F.render(V)}function Y(){const t=(new Date).getTime(),e=t-K;requestAnimationFrame(Y),F.update(e<34?e:34),K=t,Z()}p(window,"load",async()=>{!function(){const t=document.body;p(document,"keydown",t=>{X[t.keyCode]=!0,F.input(X,!0)}),p(document,"keyup",t=>{X[t.keyCode]=!1,F.input(X,!1)}),p(t,"mousedown",t=>{X[t.button]=!0,F.input(X,!0)}),p(t,"mouseup",t=>{X[t.button]=!1,F.input(X,!1)}),p(t,"mousemove",e=>{const s=j.height/t.clientHeight,i=(t.clientWidth*s-j.width)/2;F.pointer(e.clientX*s-i,e.clientY*s)}),p(document,"contextmenu",t=>t.preventDefault())}(),await A.load(s(1),s(2)),await A.tint(V,.8,.3,.1),await A.tint(V,.4,.9,.4),await A.tint(V,1,.9,0),await A.tint(V,.1,1,1),await A.tint(V,.8,.1,1),j.width=W.cam.width,j.height=W.cam.height,j.style.display="block",Y(),Z()}),p(j,"click",async()=>{if(Q)switch(F.hud.satus){case c.run:return;case c.start:return void(F.hud.satus=c.run);default:return void(F=new H(new O(k[0])))}await u.init(),await Promise.all([u.sound("hit",new a("custom",[2,1,0],1),[110,0],.2),u.sound("fire",new a("square",[.2,.1,0],.2),[660,110],.1),u.sound("eject",new a("triangle",[.2,.1,0],.2),[220,0],.1),u.sound("launch",new a("custom",[1,.5,0],1),[880,0],.1),u.sound("explode",new a("custom",[5,1,0],1),[220,0],1),u.sound("item",new a("square",[.3,.1,0],1),[220,440,220,440,220,440,220,440],.3)]),Q=!0,F.hud.satus=c.run})}]);</script></body></html>