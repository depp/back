<!DOCTYPE html><html lang="en"><head><title>BACK</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"><style type="text/css">body,html{width:100%;height:100%;margin:0;padding:0;overflow:hidden;background-color:#000;color:#fff}#hud{display:flex;justify-content:space-around;width:100%;background:rgba(0,0,0,.7)}#game,#hud{position:absolute}#game{top:0;left:0;height:100%;cursor:crosshair;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-o-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:pixelated}</style></head><body><canvas id="game" height="256"></canvas><div id="hud"><div>HP: <span></span></div><div>Ammo: <span></span></div><div>Grenade: <span></span></div><div>Score: <span></span></div></div><script type="text/javascript">!function(t){var e={};function i(s){if(e[s])return e[s].exports;var h=e[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(s,h,function(e){return t[e]}.bind(null,h));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){},function(t,e){t.exports="data:image/png;base64,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"},function(t){t.exports=JSON.parse('{"frames":{"download":{"frame":{"x":0,"y":0,"w":112,"h":195},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":112,"h":195},"sourceSize":{"w":112,"h":196},"pivot":{"x":0.5,"y":0.5}}},"meta":{"app":"http://free-tex-packer.com","version":"0.6.0","image":"texture.png","format":"RGBA8888","size":{"w":112,"h":195},"scale":1}}')},function(t,e,i){"use strict";i.r(e);i(0);window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext;const s=new AudioContext,h={},o={},r=[];let n;var a,l,c={async init(){"suspended"===s.state&&await s.resume();const t=Math.pow(2,1/12);for(let e=-57;e<50;e++)r.push(440*Math.pow(t,e));const e=(n=s.createBuffer(1,88200,44100)).getChannelData(0);for(let t=0;t<88200;t++)e[t]=2*Math.random()-1},async sound(t,e,i,s){const h=new OfflineAudioContext(1,44100*s,44100),r=h.createGain(),a=Float32Array.from(i);if(r.connect(h.destination),e.curve&&r.gain.setValueCurveAtTime(e.curve,0,e.getTime(s)),h.addEventListener("complete",e=>o[t]=e.renderedBuffer),"custom"==e.type){const t=h.createBiquadFilter();t.connect(r),t.detune.setValueCurveAtTime(a,0,s);const e=h.createBufferSource();e.buffer=n,e.loop=!0,e.connect(t),e.start()}else{const t=h.createOscillator();t.type=e.type,t.frequency.setValueCurveAtTime(a,0,s),t.connect(r),t.start(),t.stop(s)}await h.startRendering()},async music(t,e){const i=e.reduce((t,e)=>e.length>t?e.length:t,0),s=new OfflineAudioContext(1,44100*i,44100);s.addEventListener("complete",e=>o[t]=e.renderedBuffer),e.forEach((t,e)=>t.play(s)),await s.startRendering()},mixer:t=>(t in h||(h[t]=s.createGain(),h[t].connect(s.destination)),h[t]),play(t,e=!1,i="master"){if(t in o){let h=s.createBufferSource();return h.loop=e,h.buffer=o[t],h.connect(this.mixer(i)),h.start(),h}return null}};function d(t,e){return(e||document).querySelector(t)}function u(t,e,i,s=!1){t.addEventListener(e,i,s)}class p{static get(t=1,e=0,i=!0){if(t<=e)return t;p.seed=(9301*p.seed+49297)%233280;let s=e+p.seed/233280*(t-e);return i?Math.round(s):s}}p.seed=Math.random(),function(t){t[t.FIRE=0]="FIRE",t[t.ALT=2]="ALT",t[t.LEFT=65]="LEFT",t[t.RIGHT=68]="RIGHT",t[t.UP=87]="UP",t[t.DOWN=83]="DOWN"}(a||(a={}));class m{constructor(t=0,e=0){this.x=t,this.y=e}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get angle(){return Math.atan2(this.y,this.x)}set(t,e=t){return t instanceof m?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this}add(t,e=t){return t instanceof m?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=e),this}sub(t,e=t){return t instanceof m?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=e),this}scale(t){return this.x*=t,this.y*=t,this}tile(t){return new m(Math.floor(this.x/t),Math.floor(this.y/t))}invert(){return this.x=-this.x,this.y=-this.y,this}normalize(){const t=this.length;return t>0&&this.scale(1/t),this}clone(){return new m(this.x,this.y)}}class f{constructor(t,e,i=e){this.pos=t,this.width=e,this.height=i,this._center=new m}get center(){return this._center.set(this.width/2+this.pos.x,this.height/2+this.pos.y),this._center}collide(t){return this.pos.x<t.pos.x+t.width&&this.pos.x+this.width>t.pos.x&&this.pos.y<t.pos.y+t.height&&this.height+this.pos.y>t.pos.y}contains(t){return this.pos.x<=t.pos.x&&this.pos.x+this.width>=t.pos.x+t.width&&this.pos.y<=t.pos.y&&this.pos.y+this.height>=t.pos.y+t.height}intersect(t){let e=Math.round(this.pos.x),i=Math.round(this.pos.y),s=e+this.width,h=i+this.height,o=Math.round(t.pos.x),r=Math.round(t.pos.y),n=o+t.width,a=r+t.height,l=e<o?o:e,c=i<r?r:i,d=s<n?s:n,u=h<a?h:a;return new f(new m(l,c),d-l,u-c)}}class x{constructor(t,e=null,i=null,s=!0){this.type=t,this.target=e,this.payload=i,this.bubble=s,this.stoped=!1}stop(){this.stoped=!0}}class w{constructor(){this.children=[],this.listeners={all:[]}}addChild(t){return this.children.push(t),t.parent=this,this}removeChild(t){const e=this.children.indexOf(t);e>=0&&(this.children.splice(e,1),t.parent=null)}each(t){for(let e=this.children.length-1;e>=0;e--)t(this.children[e],e)}on(t,e){const i=t.match(/[a-zA-Z]+/g);i&&i.forEach(t=>{t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push(e)})}emit(t){for(const e of this.listeners.all){if(t.stoped)return;e(t)}if(t.type in this.listeners)for(const e of this.listeners[t.type]){if(t.stoped)return;e(t)}t.bubble&&this.parent&&this.parent.emit(t)}render(t){this.children.forEach(e=>e.render(t))}update(t){this.children.forEach(e=>e.update(t))}}class g extends w{constructor(t){super(),this.factory=t,this.pool=[]}create(t=null){let e=this.pool.pop();return e||(e=this.factory()),this.addChild(e),t&&t(e),e}removeChild(t){super.removeChild(t),this.pool.push(t)}}class y extends g{constructor(t,e,i,s=0,h=0){super(t),this.factory=t,this.init=e,this.box=i,this.period=s,this.limit=h,this.pos=this.box.pos,this.time=0}create(t=null){return!this.limit||this.children.length<this.limit?super.create(t):null}update(t){super.update(t),this.period<=0||(this.time+=t,this.time>this.period&&(this.time-=this.period,this.create(this.init)))}}class A extends g{constructor(t,e,i,s=0){super(t),this.factory=t,this.spd=e,this.ammo=i,this.magazine=s,this.time=0}load(t){this.ammo+=t,this.magazine&&this.ammo>this.magazine&&(this.ammo=this.magazine)}create(t=null){return this.ammo<=0||this.spd&&this.time?null:(this.ammo--,this.time=this.spd,super.create(t))}update(t){this.time=t<this.time?this.time-t:0,super.update(t)}}class b extends w{constructor(t,e,i,s){super(),this.spd=t,this.dmg=e,this.size=i,this.color=s,this.pos=new m,this.dir=new m,this.box=new f(this.pos,this.size)}render(t){const e=this.box.center;t.save(),t.fillStyle=this.color,t.beginPath(),t.arc(e.x,e.y,this.size/2,0,2*Math.PI),t.closePath(),t.fill(),t.restore()}update(t){this.pos.add(this.dir.clone().scale(this.spd*t))}}class v extends b{constructor(t,e,i,s){super(t,e,i,"#0f0"),this.spd=t,this.dmg=e,this.size=i,this.radius=s,this.aim=new m}update(t){this.box.center.sub(this.aim).length<=this.spd*t?(this.pos.set(this.aim),this.emit(new x("explode",this)),this.parent.removeChild(this)):super.update(t)}}class C extends w{constructor(t,e,i){super(),this.box=t,this.spd=e,this.maxHp=i,this.hp=this.maxHp,this.pos=this.box.pos,this.dir=new m,this.aim=new m,this.fire=!1,this.gun=new A(()=>new b(.4,25,6,"#0ff"),100,9999),this.grenades=new A(()=>new v(.2,50,10,48),0,5,10),this.score=0,this.addChild(this.grenades),this.addChild(this.gun)}render(t){super.render(t);const e=this.box,i=this.pos;t.save(),t.fillStyle="#00c",t.fillRect(i.x,i.y,e.width,e.height),t.restore()}update(t){super.update(t),this.fire&&this.gun.create(t=>{const e=t.box,i=this.box.center;t.dir.set(this.aim.clone().sub(i).normalize()),t.pos.set(i.sub(e.width/2,e.height/2)),this.emit(new x("fire",this,t))})}launch(){this.grenades.create(t=>{const e=t.box,i=this.box.center;t.dir.set(this.aim.clone().sub(i).normalize()),t.pos.set(i.sub(e.width/2,e.height/2)),t.aim.set(this.aim),this.emit(new x("launch"))})}}!function(t){t[t.WALL=0]="WALL",t[t.GROUND=1]="GROUND",t[t.HOLE=2]="HOLE",t[t.CAMP=3]="CAMP",t[t.SHOT=4]="SHOT"}(l||(l={}));class M{constructor(t,e=[]){this.map=t,this.poi=e}}class O extends w{constructor(t,e,i){super(),this.width=t,this.size=e,this.height=0,this.tiles=[],this.nav=[],this.segments=[new M([[5],[1,1,11],[2,4,8]]),new M([[1,1,11],[11]],[[2,4,3],[3,0,11,1,11,2,11],[4,8,3]]),new M([[4,3,12],[6,3,9],[4,0,9]],[[2,10,2]]),new M([[6],[4,0,4,8,12]]),new M([[6],[3,0,2,4,8,10,12]])];for(const t of i){const e=this.height,i=this.segments[t];this.loadMap(i.map),this.loadPoi(i.poi,e)}}loadMap(t){for(const e of t)for(let t=0;t<e[0];t++){const t=new Array(this.width);if(1===e.length)t.fill(l.GROUND);else{t.fill(l.WALL);for(let i=1;i<e.length;i+=2)t.fill(l.GROUND,e[i],e[i+1])}this.tiles[this.height]=t,this.nav[this.height++]=new Array(this.width).fill(O.MAX_NAV)}}loadPoi(t,e){for(const i of t)for(let t=1;t<i.length;t+=2)this.setTile(i[t],i[t+1]+e,i[0])}render(t){const e=this.size;t.save();for(let i=0;i<this.height;i++)for(let s=0;s<this.width;s++)this.tiles[i][s]!==l.WALL&&(t.fillStyle="#666",t.fillRect(s*e+1,i*e+1,e-2,e-2));t.restore(),super.render(t)}setTile(t,e,i){e>=0&&e<this.height&&t>=0&&t<this.width&&(this.tiles[e][t]=i)}getTile(t,e){return e>=0&&e<this.height&&t>=0&&t<this.width?this.tiles[e][t]:l.WALL}getPosByTile(t){const e=[];for(let i=0;i<this.height;i++)for(let s=0;s<this.height;s++)this.tiles[i][s]===t&&e.push(new m(s*this.size,i*this.size));return e}collideX(t,e=!1){let i=t.pos,s=this.size,h=Math.floor(i.y/s),o=Math.floor(i.x/s),r=Math.floor((i.x+t.width)/s);for(let n=h*s;n<i.y+t.height;n+=s){let h=Math.floor(n/s);if(!this.getTile(o,h))return e&&(i.x+=(o+1)*s-i.x),!0;if(!this.getTile(r,h))return e&&(i.x-=i.x+t.width-r*s),!0}return!1}collideY(t,e=!1){let i=t.pos,s=this.size,h=Math.floor(i.y/s),o=Math.floor(i.x/s),r=Math.floor((i.y+t.height)/s);for(let n=o*s;n<i.x+t.width;n+=s){let o=Math.floor(n/s);if(!this.getTile(o,h))return e&&(i.y+=(h+1)*s-i.y),!0;if(!this.getTile(o,r))return e&&(i.y-=i.y+t.height-r*s),!0}return!1}createNav(t){const e=t.tile(this.size);this.nav.forEach(t=>t.fill(O.MAX_NAV)),this.setNav(e.x,e.y)}lockNav(t){const e=t.tile(this.size);this.nav[e.y][e.x]=O.MAX_NAV}setDirection(t){const e=this.size,i=t.box.center,s=i.tile(e);t.dir.set(0,0);let h=O.MAX_NAV;h=this.setDir(t,s,new m(1,0),h),h=this.setDir(t,s,new m(-1,0),h),h=this.setDir(t,s,new m(0,1),h),h=this.setDir(t,s,new m(0,-1),h),t.dir.x?(this.getTile(s.x,s.y+1)&&(h=this.setDir(t,s,new m(t.dir.x,1),h)),this.getTile(s.x,s.y-1)&&(h=this.setDir(t,s,new m(t.dir.x,-1),h))):t.dir.y&&(this.getTile(s.x+1,s.y)&&(h=this.setDir(t,s,new m(1,t.dir.y),h)),this.getTile(s.x-1,s.y)&&(h=this.setDir(t,s,new m(-1,t.dir.y),h))),t.dir.add(s).scale(e).add(e/2).sub(i).normalize()}setDir(t,e,i,s){const h=this.getNav(e.x+i.x,e.y+i.y);return s>h&&(t.dir=i,s=h),s}getNav(t,e){return e>=0&&e<this.height&&t>=0&&t<this.width?this.nav[e][t]:O.MAX_NAV}setNav(t,e,i=0){i>=O.MAX_NAV||!this.getTile(t,e)||i>=this.nav[e][t]||(this.nav[e][t]=i++,this.setNav(t+1,e,i),this.setNav(t,e+1,i),this.setNav(t-1,e,i),this.setNav(t,e-1,i))}}O.MAX_NAV=30;class T extends w{constructor(t,e,i,s){super(),this.hero=t,this.maxHp=e,this.dmg=i,this.score=s,this.hp=this.maxHp,this.pos=new m,this.box=new f(this.pos,16)}update(t){if(super.update(t),this.box.collide(this.hero.box))return this.emit(new x("hit",this.hero,this.dmg)),void this.parent.removeChild(this);for(const t of this.hero.gun.children)if(this.box.collide(t.box))return this.emit(new x("hit",this,t.dmg)),void t.parent.removeChild(t)}}class D extends T{render(t){const e=this.box,i=e.center;t.save(),t.fillStyle="#0c0",t.beginPath(),t.arc(i.x,i.y,e.width/2,0,2*Math.PI),t.closePath(),t.fill(),t.restore()}}class S extends T{constructor(t,e,i,s,h){super(t,e,i,s),this.hero=t,this.maxHp=e,this.dmg=i,this.score=s,this.far=h,this.gun=new A(()=>new b(.1,10,6,"#fff"),500,9999),this.addChild(this.gun)}render(t){const e=this.box,i=e.center;t.save(),t.fillStyle="#c0c",t.beginPath(),t.arc(i.x,i.y,e.width/2,0,2*Math.PI),t.closePath(),t.fill(),t.restore(),super.render(t)}update(t){super.update(t),this.gun.each(t=>{t.box.collide(this.hero.box)&&this.emit(new x("hit",this.hero,t.dmg))});const e=this.box.center,i=this.hero.box.center.sub(e);i.length>this.far||this.gun.create(t=>{const s=t.box;t.dir.set(i.normalize()),t.pos.set(e.sub(s.width/2,s.height/2)),this.emit(new x("fire",t))})}}class E extends T{constructor(){super(...arguments),this.dir=new m,this.spd=.1}render(t){const e=this.box,i=this.pos;t.save(),t.fillStyle="#c00",t.fillRect(i.x,i.y,e.width,e.height),t.restore()}}class L extends y{constructor(t,e,i,s=0,h=0,o=0,r=0){super(t,e,i,s,h),this.factory=t,this.init=e,this.box=i,this.period=s,this.limit=h,this.near=o,this.far=r,this.active=!1}create(t=null){return this.active?super.create(t):null}toggle(t){const e=this.box.center.sub(t).length;e>this.far?this.active=!1:!this.active&&t.y>this.box.center.y&&e<this.near&&(this.active=!0,this.emit(new x("spawn",this)))}render(t){const e=this.box.center;t.save(),t.fillStyle="#000",t.beginPath(),t.arc(Math.round(e.x),Math.round(e.y),this.box.width/2,0,2*Math.PI),t.closePath(),t.fill(),t.restore(),super.render(t)}}class H extends w{constructor(t){super(),this.hero=t,this.hud=d("#hud").getElementsByTagName("span")}update(t){const e=this.hud,i=this.hero;e.item(0).innerText=i.hp.toString(),e.item(1).innerText=i.gun.ammo.toString(),e.item(2).innerText=i.grenades.ammo.toString(),e.item(3).innerText=i.score.toString()}}i(1),i(2);const P=d("#game"),R=P.getContext("2d"),V=new class extends w{constructor(){super(),this.hero=new C(new f(new m(0,100),16,24),.2,100),this.map=new O(12,16,[1,2,3,4,0]),this.cam=new f(new m(0,-64),192,256),this.spd=.02,this.aim=new m,this.camps=new g(()=>new D(this.hero,20,0,10)),this.shots=new g(()=>new S(this.hero,50,0,50,240)),this.holes=[],this.hero.pos.set(96,128),this.map.createNav(this.hero.box.center),this.addChild(this.map);for(const t of this.map.getPosByTile(l.CAMP))this.camps.create(e=>e.pos.set(t));for(const t of this.map.getPosByTile(l.SHOT))this.shots.create(e=>e.pos.set(t));for(const t of this.map.getPosByTile(l.HOLE)){const e=new L(()=>new E(this.hero,20,10,25),e=>e.pos.set(t),new f(t,16,16),100,20,180,320);this.holes.push(e),this.addChild(e)}this.addChild(this.camps).addChild(this.shots).addChild(this.hero).addChild(new H(this.hero)),this.bind()}bind(){this.on("hit",t=>{const e=t.target;e instanceof T&&(e.hp-=t.payload,e.hp<0&&(this.emit(new x("kill",e)),this.hero.score+=e.score,e.parent.removeChild(e),e.hp=e.maxHp)),e instanceof C&&(e.hp-=t.payload,e.hp<0&&(e.hp=0))}),this.on("explode",t=>{const e=t.target;this.camps.each(t=>this.explode(e,t)),this.shots.each(t=>this.explode(e,t));for(const t of this.holes)t.each(t=>this.explode(e,t))})}explode(t,e){const i=t.box.center,s=e.box.center.sub(i).length;t.radius>=s&&this.emit(new x("hit",e,t.dmg))}render(t){t.save(),t.translate(this.cam.pos.x,-this.cam.pos.y),super.render(t),t.restore()}update(t){const e=this.map,i=this.cam;let s=this.spd*t;const h=e.height*e.size-i.height;i.pos.y+=s,i.pos.y>h&&(i.pos.y=h,s=0),super.update(t),this.updateHero(t,s),this.updateProjectile(t),this.updateMap(),this.updateSpawners(t)}updateHero(t,e){const i=this.hero;i.dir.x&&(i.pos.x+=i.dir.x*i.spd*t,this.map.collideX(i.box,!0)),i.dir.y&&(i.pos.y+=i.dir.y*i.spd*t),i.pos.y+=e,this.map.collideY(i.box,!0);const s=this.cam;i.aim.set(this.aim).add(-s.pos.x,s.pos.y);const h=s.pos.y+s.height-i.pos.y-i.box.height;h<0&&(i.pos.y+=h)}updateProjectile(t){this.hero.gun.each(t=>{(this.map.collideX(t.box)||this.map.collideY(t.box))&&t.parent.removeChild(t)}),this.hero.grenades.each(t=>{(this.map.collideX(t.box)||this.map.collideY(t.box))&&(t.emit(new x("explode",t)),t.parent.removeChild(t))}),this.shots.each(t=>{t.gun.each(t=>{(this.map.collideX(t.box)||this.map.collideY(t.box))&&t.parent.removeChild(t)})})}updateMap(){this.map.createNav(this.hero.box.center);for(const t of this.holes)for(const e of t.children)this.map.lockNav(e.box.center)}updateSpawners(t){for(const e of this.holes){e.toggle(this.hero.pos);for(const i of e.children){this.map.setDirection(i);const e=i.spd*t;i.pos.add(i.dir.x*e,i.dir.y*e)}}}pointer(t,e){this.aim.set(t,e)}input(t,e){let i=0,s=0;t[a.LEFT]&&(i-=1),t[a.RIGHT]&&(i+=1),t[a.UP]&&(s-=1),t[a.DOWN]&&(s+=1),this.hero.dir.set(i,s).normalize(),this.hero.fire=!0===t[a.FIRE],t[a.ALT]&&e&&this.hero.launch()}},B=[];let I,k=!1;function j(){R.fillStyle="black",R.fillRect(0,0,P.width,P.height),V.render(R)}function z(){const t=(new Date).getTime(),e=t-I;requestAnimationFrame(z),V.update(e<34?e:34),I=t,j()}function K(){const t=document.body;P.width=P.height/t.clientHeight*t.clientWidth,V.cam.pos.x=(P.width-V.cam.width)/2}u(window,"load",()=>{u(document,"contextmenu",t=>t.preventDefault()),K(),j(),u(document,"keydown",t=>{B[t.keyCode]=!0,V.input(B,!0)}),u(document,"keyup",t=>{B[t.keyCode]=!1,V.input(B,!1)}),u(document,"mousedown",t=>{B[t.button]=!0,V.input(B,!0)}),u(document,"mouseup",t=>{B[t.button]=!1,V.input(B,!1)}),u(document,"mousemove",t=>{const e=document.body,i=P.height/e.clientHeight;V.pointer(t.clientX*i,t.clientY*i)}),u(window,"resize",K)}),u(document,"click",async()=>{k||(await c.init(),I=(new Date).getTime(),k=!0,z())})}]);</script></body></html>